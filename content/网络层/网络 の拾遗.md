# 网络 の 拾遗

网络层学习计划:

- 工具: 青花瓷,wireshark(ext:抓app旧版本;如何防止抓包)
- HTTP
- HTTPS
- NSURLSession
- AFNetworking
- TCP,UDP


## 1.HTTP

[Hypertext Transfer Protocol HTTP/1.0 - rfc1945](https://tools.ietf.org/html/rfc1945#section-8)
****

### 1.1 请求报文

![SamuelChan/20180714223810.png](http://ormqbgzmy.bkt.clouddn.com/SamuelChan/20180714223810.png)

```json
1. Cache 头域
If-Modified-Since:: Thu, 09 Feb 2012 09:07:57 GMT
If-None-Match: "03f2b33c0bfcc1:0" (ETag)
Cache-Control: max-age=0

2. Client 头域
Accept: text/html,application/xhtml+xml,application/xml;
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64)

3. Cookie/Login 头域
Cookie: 最重要的header, 将cookie的值发送给HTTP 服务器

4. Entity头域
Content-Type: application/json  (除了self.HTTPMethodsEncodingParametersInURI = [NSSet setWithObjects:@"GET", @"HEAD", @"DELETE", nil],其他method都有这个字段,标识请求体的消息类型)
Content-Length: 100

5.Miscellaneous 头域
Referer:http://translate.google.cn/?hl=zh-cn&tab=wT (从哪个网站过来的请求)

6. Transport 头域
Connection: keep-alive
Host: 127.0.0.1

```

### 1.2 响应报文

![SamuelChan/20180714231704.png](http://ormqbgzmy.bkt.clouddn.com/SamuelChan/20180714231704.png)

```json
1. Cache头域
Date: Sat, 11 Feb 2012 11:35:14 GMT
Expires: Tue, 08 Feb 2022 11:35:14 GMT

2.Cookie/Login 头域
Set-Cookie非常重要的header, 用于把cookie 发送到客户端浏览器， 每一个写入cookie都会生成一个Set-Cookie.
Set-Cookie: sc=4c31523a; path=/; domain=.acookie.taobao.com

3. Entity头域

ETag: "03f2b33c0bfcc1:0(和If-None-Match 配合使用)
Last-Modified: Wed, 21 Dec 2011 09:09:10 GMT
 
Content-Type: text/html; charset=utf-8
Content-Type:text/html;charset=GB2312
Content-Type: image/jpeg
 
Content-Length
指明实体正文的长度，以字节方式存储的十进制数字来表示。在数据下行的过程中，Content-Length的方式要预先在服务器中缓存所有数据
Content-Length: 19847
 
Content-Encoding
WEB服务器表明自己使用了什么压缩方法（gzip，deflate）压缩响应中的对象。
例如：Content-Encoding：gzip
 
Content-Language
作用： WEB服务器告诉浏览器自己响应的对象的语言者
例如： Content-Language:da

4. Miscellaneous 头域
Server: Microsoft-IIS/7.5

5.Transport头域
Connection: keep-alive

```

### 1.3 Method

`GET`     请求获取Request-URI所标识的资源

`POST`    在Request-URI所标识的资源后附加新的数据

> The HEAD method is identical to GET except that the server must not return any Entity-Body in the response.

`HEAD`    请求获取由Request-URI所标识的资源的响应消息报头

`PUT`     请求服务器存储一个资源，并用Request-URI作为其标识

`DELETE`  请求服务器删除Request-URI所标识的资源

`TRACE`   请求服务器回送收到的请求信息，主要用于测试或诊断

`CONNECT` 保留将来使用

`OPTIONS` 请求查询服务器的性能，或者查询与资源相关的选项和需求

### 1.4 GET和POST的区别

语义角度

- 安全性 : 不应该引起Server端的状态变化(GET,HEAD,OPTIONS)
- 幂等性 : 可重入(GET,PUT,OPTIONS)
- 可缓存性: 请求是否能被缓存

GET : 安全,幂等,可缓存的

POST : 不安全,不幂等,不可缓存

### 1.5 HTTP特点

- 无连接 : HTTP长连接(http1.1)    1.Content-Length 2.POST : 最后一个chunked为空
- 无状态 : Cookie/Session

## 2. HTTPS

### 建立连接流程

HTTP :  tcp三次握手 + 请求响应

HTTPS : tcp三次握手 + 非对称协商会话密钥 + 对称加密开始通信

## 3. TCP/UDP

### 3.1 UDP

- 无连接
- 尽努力送达
- 报文为单位 (不会拆解报文)
- 复用/分用
- 差错检测(checksum)

### 3.2 TCP

- 面向连接
- 可靠传输
- 面向字节流
- 流量控制
- 拥塞控制

#### 可靠传输

通过停止等待协议实现:  `无差错` `超时重传` `确认丢失` `确认迟到`

#### 面向字节流
![SamuelChan/20180715000231.png](http://ormqbgzmy.bkt.clouddn.com/SamuelChan/20180715000231.png)

#### 流量控制

滑动窗口协议
![SamuelChan/20180715000847.png](http://ormqbgzmy.bkt.clouddn.com/SamuelChan/20180715000847.png)

#### 拥塞控制

慢开始(拥塞避免)
快恢复(快重传)
![SamuelChan/20180715001109.png](http://ormqbgzmy.bkt.clouddn.com/SamuelChan/20180715001109.png)

## 4.Session,Cookie

用来解决http是无状态的, 可以标识用户
Cookie存放在客户端
Session在服务端